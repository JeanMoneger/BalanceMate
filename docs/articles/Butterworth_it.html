<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Filtering Postural Data Using a Butterworth Filter • BalanceMate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Filtering Postural Data Using a Butterworth Filter">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BalanceMate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Butterworth_it.html">Filtering Postural Data Using a Butterworth Filter</a></li>
    <li><a class="dropdown-item" href="../articles/Compute_Postural_Indicators.html">Compute Postural Indicators</a></li>
    <li><a class="dropdown-item" href="../articles/CoPX_ComputeR.html">Compute CoP X</a></li>
    <li><a class="dropdown-item" href="../articles/CoPY_ComputeR.html">Compute CoP-Y</a></li>
    <li><a class="dropdown-item" href="../articles/EllipseArea.html">Compute X% Confidence Ellipse Area</a></li>
    <li><a class="dropdown-item" href="../articles/Epoch_SliceR.html">Synthetise your data into time-bins</a></li>
    <li><a class="dropdown-item" href="../articles/Mean_CoP_ComputeR.html">Compute Mean CoP displacements</a></li>
    <li><a class="dropdown-item" href="../articles/Merge_PosData.html">Merge and Structure postural data</a></li>
    <li><a class="dropdown-item" href="../articles/SD_CoP_ComputeR.html">Compute Standard deviations of CoP displacements</a></li>
    <li><a class="dropdown-item" href="../articles/SpaghettEllipse.html">Visualise Stabilogram and Confidence Ellipse</a></li>
    <li><a class="dropdown-item" href="../articles/SPL_ComputeR.html">Compute Sway Path Length</a></li>
    <li><a class="dropdown-item" href="../articles/Time_StampeR.html">Time_StampeR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JeanMoneger/BalanceMate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Filtering Postural Data Using a Butterworth Filter</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JeanMoneger/BalanceMate/blob/HEAD/vignettes/Butterworth_it.Rmd" class="external-link"><code>vignettes/Butterworth_it.Rmd</code></a></small>
      <div class="d-none name"><code>Butterworth_it.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jeanmoneger.github.io/BalanceMate">BalanceMate</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'kableExtra' was built under R version 4.2.3</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="description">Description<a class="anchor" aria-label="anchor" href="#description"></a>
</h2>
<p>Signal processing often involves removing noise or smoothing data to
improve interpretability. In postural data, tiny spikes in signals can
complicate analysis. Filtering is a common approach to address these
issues, with the Butterworth filter being one of the most popular
methods. This vignette demonstrates how to use the
<code>Butterworth_it</code> function from the <code>BalanceMate</code>
package to apply a Butterworth filter to postural data, including
examples of its application.</p>
<div class="section level3">
<h3 id="a-short-digression-on-signals">A short digression on signals<a class="anchor" aria-label="anchor" href="#a-short-digression-on-signals"></a>
</h3>
<p>The author of this package being quite naive regarding signal filters
(interested readers are re-directed to the <code>signal</code> package),
it can be noted that – drawing on the literature on approach and
avoidance of (un)pleasant stimuli, some types of filters are more
popular than others (see Table X). In particular the most used type of
filters would be: No filter at all, a 2nd order low-pass Butterworth
filter with a cut-off frequency of 5Hz, and then a 2nd order low-pass
Butterworth filter with a cut-off frequency of 10Hz.</p>
<table style="width:50%;" class="table">
<caption>
Cut-Off Frequency usage in the literature
</caption>
<thead><tr>
<th style="text-align:left;">
Cut-off Frequency used
</th>
<th style="text-align:right;">
Number of papers
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
10Hz
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
15Hz
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
20Hz
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
5Hz
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
8Hz
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
No filter used
</td>
<td style="text-align:right;">
25
</td>
</tr>
<tr>
<td style="text-align:left;">
Not enough information
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Other
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<table style="width:50%;" class="table">
<caption>
Filter’s order usage in the literature
</caption>
<thead><tr>
<th style="text-align:left;">
Order of the filter used
</th>
<th style="text-align:right;">
Number of papers
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2nd Order
</td>
<td style="text-align:right;">
10
</td>
</tr>
<tr>
<td style="text-align:left;">
3rd Order
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
N/A
</td>
<td style="text-align:right;">
26
</td>
</tr>
<tr>
<td style="text-align:left;">
Unknown
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
<p>Regarding high vs low-pass; it appears all filters either mention
explicitly using a low-pass filter, or do not report which type of
filter they used.</p>
<hr>
<p><strong><em>Note</em></strong>: <em>other types of filter where
5-points moving average (n = 1).</em></p>
<hr>
</div>
<div class="section level3">
<h3 id="usage-example">Usage example<a class="anchor" aria-label="anchor" href="#usage-example"></a>
</h3>
<p>Butterworth filter is by far the most used type of filter. It is a
wrapper of the <code>filtfilt</code> and <code>butter</code> commands of
the <code>signal</code> package. To use it, you need to specify the
column(s) you want to filter, indicate the order you want to use, the
cut-off frequency for the filter, and whether you would like a high or
low-pass filter to be applied.</p>
<hr>
<p><strong><em>Note</em></strong>: <em>the filter is used on the raw
data, before any synthesis is done. It can be applied to the moments and
forces (used to compute CoP), or on the CoP itself – this does not
produce much difference from what I have tested. Because the filter is
applied on raw data, the computation might take some time for large
datasets.</em></p>
<hr>
<p>Based on the literature and the popularity of this specific filter
(see Monéger et al., 2024 [preprint]), you want to use a <strong>2nd
order Butterworth filter</strong> with a <strong>cut-off frequency of
5Hz.</strong></p>
<p><em>Note: the files are stored as Rdata to reduce the size of the
package – however the command only accepts txt files, hence it is
required to first convert Rdata to text files before running the
examples</em></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Locate the installed extdata/ folder (contains only .RData now)</span></span>
<span><span class="va">path_extdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"BalanceMate"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Find all .RData (case‐insensitive)</span></span>
<span><span class="va">rdata_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  <span class="va">path_extdata</span>,</span>
<span>  pattern    <span class="op">=</span> <span class="st">"\\.[Rr][Dd]ata$"</span>,</span>
<span>  full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Convert each .RData to a .txt in a temp directory</span></span>
<span><span class="va">tmpdir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">f</span> <span class="kw">in</span> <span class="va">rdata_files</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/load.html" class="external-link">load</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span>  <span class="co"># e.g. loads object “Postural_DataA” into your session</span></span>
<span>  <span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">basename</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="va">nm</span><span class="op">)</span>,</span>
<span>    file      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">tmpdir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">nm</span>, <span class="st">".txt"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    sep       <span class="op">=</span> <span class="st">","</span>,</span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    col.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    quote     <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span></span>
<span><span class="co"># 4. Merge from the tempdir</span></span>
<span><span class="va">Data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Merge_PosData.html">Merge_PosData</a></span><span class="op">(</span></span>
<span>  directory_path <span class="op">=</span> <span class="va">tmpdir</span>,              </span>
<span>  SampleRate     <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  SessionDuration<span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">filtered_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Butterworth_it.html">Butterworth_it</a></span><span class="op">(</span></span>
<span>  Data <span class="op">=</span> <span class="va">Data</span>,</span>
<span>  cutoff_freq <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  filter_order <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  sampling_rate <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"low"</span>,</span>
<span>  Colname <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CoP_X"</span>, <span class="st">"CoP_Y"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The resulting data file contains now one column with the raw
untransformed signal and one column with the filtered signal.</p>
<p>We can now compare the original signal to the filtered signal to
assess whether the filter did not result in some weird signal. Because
we have a lot of data, I only illustrate here what happened in a
specific sample of measures in one participant (I however do recommend
that users try multiple samples including the beginning and the end of
specific trial; see for instance: <a href="https://stackoverflow.com/questions/67847747/butterworth-filter-results-in-extreme-outliers-at-start-of-the-signal" class="external-link uri">https://stackoverflow.com/questions/67847747/butterworth-filter-results-in-extreme-outliers-at-start-of-the-signal</a>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># File names</span></span>
<span><span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Postural_DataB.txt"</span>, <span class="st">"Postural_DataA.txt"</span>, <span class="st">"Postural_DataD.txt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop through file names to generate plots side by side</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">file</span> <span class="kw">in</span> <span class="va">file_names</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Original signal plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">filtered_data</span>, <span class="va">filtered_data</span><span class="op">$</span><span class="va">file_name</span> <span class="op">==</span> <span class="va">file</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="fl">32</span><span class="op">)</span><span class="op">$</span><span class="va">Time</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">filtered_data</span>, <span class="va">filtered_data</span><span class="op">$</span><span class="va">file_name</span> <span class="op">==</span> <span class="va">file</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="fl">32</span><span class="op">)</span><span class="op">$</span><span class="va">CoP_Y</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Original Signal:"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"CoP-Y"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Filtered signal plot</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">filtered_data</span>, <span class="va">filtered_data</span><span class="op">$</span><span class="va">file_name</span> <span class="op">==</span> <span class="va">file</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="fl">32</span><span class="op">)</span><span class="op">$</span><span class="va">Time</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">filtered_data</span>, <span class="va">filtered_data</span><span class="op">$</span><span class="va">file_name</span> <span class="op">==</span> <span class="va">file</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&gt;</span> <span class="fl">30</span> <span class="op">&amp;</span> <span class="va">filtered_data</span><span class="op">$</span><span class="va">Time</span> <span class="op">&lt;</span> <span class="fl">32</span><span class="op">)</span><span class="op">$</span><span class="va">CoP_Y_filtered</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>    main <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Filtered Signal:"</span>, <span class="va">file</span><span class="op">)</span>,</span>
<span>    xlab <span class="op">=</span> <span class="st">"Time"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"CoP-Y"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-1.png" width="700"><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-2.png" width="700"><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-3.png" width="700"><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-4.png" width="700"><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-5.png" width="700"><img src="Butterworth_it_files/figure-html/unnamed-chunk-4-6.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="further-readings">Further readings<a class="anchor" aria-label="anchor" href="#further-readings"></a>
</h3>
<p>I recommend reading the documentation of the <a href="https://cran.r-project.org/web/packages/signal/index.html" class="external-link"><code>signal</code></a>
package and the chapter of the <a href="https://jeanmoneger.com/book/pre-processing" class="external-link">BalanceMate
book</a>.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jean Monéger.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
